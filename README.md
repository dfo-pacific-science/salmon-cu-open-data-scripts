# salmon-cu-open-data-scripts

R scripts for extracting NuSEDS data for submission to the [Open Government Portal](https://search.open.canada.ca/opendata/) (Open Data).

## Overview

This repository contains R scripts used to extract and prepare data from NuSEDS exports. The scripts replicate SQL queries previously run manually and produce CSV files for upload to Open Data.

Outputs are intended to be uploaded as part of the [Pacific salmon conservation units (CU) sites and status Open Data Record](https://open.canada.ca/data/en/dataset/1ac00a39-4770-443d-8a6b-9656c06df6a3).

## Scripts

-   `cu_status_extraction.R`: Extracts status assessments for Pacific salmon CUs.
-   `cu_sites_extraction.R`: Extracts site-level information including coordinates, watershed codes, and CU identifiers.
-   `cu_boundary_extraction.R`: Extracts CU-level metadata for mapping and boundary file generation.

## Folder Structure

```         
scripts/   - R scripts for data extraction
data/      - Raw Excel files (excluded from GitHub via .gitignore)
output/    - CSV files generated by the scripts
sql/       - Original SQL queries used to generate the data. Provided for reference.
```

## How to Use

1.  Connect RStudio to this GitHub repository. If you're unfamiliar with the process, there are many tutorials available online, such as [this guide from UC Davis](https://ucd-r-davis.github.io/R-DAVIS/setting_up_git.html).

2.  Place the required Excel files in the `data/` folder:

    -   `cu_profile_vw.xlsx`
    -   `conserv_unit_system_sites_mv.xlsx`
    -   `Geo_Features.xlsx`

3.  Open each script in RStudio and run it.

4.  Each script will:

    -   Load the Excel files into DuckDB
    -   Run SQL queries individually
    -   Save the results as CSV files in the `output/` folder

## Notes

-   The original SQL queries used to generate these outputs cannot be run directly within R. Instead, they have been translated into equivalent SQL statements that are executed using DuckDB. DuckDB supports only one `SELECT` query per execution, so each query is run individually within the scripts.

-   Users must manually export the required tables and views from the NuSEDS database to Excel format. These files are not included in the repository and must be placed in the `data/` folder before running the scripts. Future work may investigate connecting to NuSEDS more directly.
